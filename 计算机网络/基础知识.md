# 网络模型

<div align="center">    
    <img src='_figs/module.png' width="700" />
</div>


# 当键入网址后，到网页显示，其间发生了什么

## 简单版

1. DNS 解析:将域名解析成 IP 地址
2. TCP 连接：TCP 三次握手
3. 发送 HTTP 请求
4. 服务器处理请求并返回 HTTP 报文
5. 浏览器解析渲染页面
6. 断开连接：TCP 四次挥手

## 底层版

1. 浏览器做的第一步工作是解析 URL, 得到「域名」以及「访问文件名」。
2. 产生 `HTTP` 请求。
3. 利用 `DNS` , 根据域名，查询目标的 IP 地址。
4. 将 `HTTP` 请求交给协议栈。
   1. TCP 协议。 添加 「TCP头部」以及根据 「MSS」进行分包。（TCP头部中不包含IP信息）
   2. 生成「IP包」。添加「IP头部」，其中包含IP信息。
   3. 生成「网络包」。添加「MAC头部」，其中包含MAC地址信息。其中涉及「ARP协议」
   4. 
5. 从「网卡」发出。将数字信息转换为电信号，才能在网线上传输。
6. 经由「交换机」交换。交换机是二级网络设备。根据 `MAC地址` ， 转发至对应的端口。如果找不到转发条目，则转发给除了发送放之外的所有端口。
7. 经过「路由器」路由。接收到包之后，路由器首先会判断是不是发给自己的包，如果不是则丢弃；如果是，则会丢弃旧的「MAC」头部。根据「路由表」找到下一跳的「网关IP」，根据下一跳的网关地址， 在 `ARP` 协议的帮助下添加新的MAC地址，接着转发至新的「路由器」或者本地的「交换机」。

> `源 IP` 和 `目标 IP` 始终是不会变的，一直变化的是 `MAC 地址`，因为需要 MAC 地址在以太网内进行两个设备之间的包传输。